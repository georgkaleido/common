apiVersion: batch/v1
kind: Job
metadata:
  name: qi-batch-evaluation-manual
spec:
  parallelism: 1
  template:
    metadata:
      name: qi-batch-evaluation-manual
    spec:
      # Necessary to have enough shared memory
      volumes:
        - name: dshm
          emptyDir:
            medium: Memory
      containers:
        - name: qi-batch-evaluation-manual
          image: eu.gcr.io/kaleido-train/trimap-qi-auto-batch-evaluation:v1 # Name of the docker image
          imagePullPolicy: Always
          args:
            - "--batch_names=Livia"
            - "--qi_names=2021-09-07_qi"
        env:
          - name: GITHUB_AUTH_TOKEN
              valueFrom:
                secretKeyRef:
                  name: auth-secrets
                  key: github-token
          - name: DANNI_USER
            valueFrom:
              secretKeyRef:
                name: auth-secrets
                key: danni-user
          - name: DANNI_TOKEN
            valueFrom:
              secretKeyRef:
                name: auth-secrets
                key: danni-token
        # Ensure that the node has a GPU
        resources:
          limits:
            nvidia.com/gpu: 1
        # Necessary to have enough shared memory
        volumeMounts:
          - mountPath: /dev/shm
            name: dshm
      restartPolicy: OnFailure
