apiVersion: batch/v1
kind: CronJob
metadata:
  name: qi-auto-postprocessing
spec:
  # Run once a month at 3:30am of the 21st day of the month
  schedule: "30 3 21 * *"
#  schedule: "11 7 20 * *" # TEST
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          # Necessary to have enough shared memory
          volumes:
            - name: dshm
              emptyDir:
                medium: Memory
          containers:
            - name: qi-auto-initialization
              image: eu.gcr.io/kaleido-train/trimap-qi-auto-postprocessing:v3
              imagePullPolicy: Always
              args:
                - "--danni_user=[...]"
                - "--danni_token=[...]"
              # Ensure that the node has a GPU
              resources:
                limits:
                  nvidia.com/gpu: 1
              # Necessary to have enough shared memory
              volumeMounts:
                - mountPath: /dev/shm
                  name: dshm
